package pl.edu.amu.wmi.betterjira.api.function.test;

import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.TimeZone;

import com.google.mockwebserver.MockResponse;
import com.google.mockwebserver.MockWebServer;

import pl.edu.amu.wmi.betterjira.api.ServerConnector;
import pl.edu.amu.wmi.betterjira.api.function.BasicAuthentication;
import pl.edu.amu.wmi.betterjira.api.function.CommentFunction;
import pl.edu.amu.wmi.betterjira.api.function.data.Comment;
import pl.edu.amu.wmi.betterjira.api.function.data.CommentsList;
import pl.edu.amu.wmi.betterjira.api.function.data.Session;
import pl.edu.amu.wmi.betterjira.api.function.data.test.TestActivity;
import pl.edu.amu.wmi.betterjira.api.function.exception.BadResponse;
import pl.edu.amu.wmi.betterjira.api.function.exception.LoginException;
import pl.edu.amu.wmi.betterjira.utils.UserInfo;
import android.annotation.SuppressLint;
import android.test.ActivityInstrumentationTestCase2;
import android.util.Log;

@SuppressLint("SimpleDateFormat")
public class CommentFunctionTest extends
		ActivityInstrumentationTestCase2<TestActivity> {

	public CommentFunctionTest() {
		super(TestActivity.class.getPackage().toString(), TestActivity.class);
	}

	public void testGetAllComments() throws LoginException, BadResponse,
			IOException {

		MockWebServer server = new MockWebServer();
		server.enqueue(new MockResponse()
				.setBody("{\"session\":{\"value\":\"4192C9DD35545EFFDAA9EAE196AFAC41\",\"name\":\"JSESSIONID\"},\"loginInfo\":{\"previousLoginTime\":\"2013-06-07T10:13:55.759+0200\",\"loginCount\":184}}"));
		server.enqueue(new MockResponse()
				.setBody("{\"startAt\":0,\"maxResults\":21,\"total\":21,\"comments\":[{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10136\",\"id\":\"10136\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s369962\",\"name\":\"s369962\",\"emailAddress\":\"mm54312@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s369962&avatarId=10303\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s369962&avatarId=10303\"},\"displayName\":\"Marcin Skibicki\",\"active\":true},\"body\":\"umgnt \",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s369962\",\"name\":\"s369962\",\"emailAddress\":\"mm54312@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s369962&avatarId=10303\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s369962&avatarId=10303\"},\"displayName\":\"Marcin Skibicki\",\"active\":true},\"created\":\"2013-03-20T14:37:22.807+0100\",\"updated\":\"2013-03-20T14:37:22.807+0100\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10137\",\"id\":\"10137\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s369962\",\"name\":\"s369962\",\"emailAddress\":\"mm54312@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s369962&avatarId=10303\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s369962&avatarId=10303\"},\"displayName\":\"Marcin Skibicki\",\"active\":true},\"body\":\"umgnt \",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s369962\",\"name\":\"s369962\",\"emailAddress\":\"mm54312@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s369962&avatarId=10303\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s369962&avatarId=10303\"},\"displayName\":\"Marcin Skibicki\",\"active\":true},\"created\":\"2013-03-20T14:37:26.936+0100\",\"updated\":\"2013-03-20T14:37:26.936+0100\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10417\",\"id\":\"10417\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-05-17T10:21:00.366+0200\",\"updated\":\"2013-05-17T10:21:00.366+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10418\",\"id\":\"10418\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-05-17T11:43:01.394+0200\",\"updated\":\"2013-05-17T11:43:01.394+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10430\",\"id\":\"10430\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-05-26T11:33:32.044+0200\",\"updated\":\"2013-05-26T11:33:32.044+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10431\",\"id\":\"10431\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-05-26T12:09:28.600+0200\",\"updated\":\"2013-05-26T12:09:28.600+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10432\",\"id\":\"10432\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-05-26T12:11:13.513+0200\",\"updated\":\"2013-05-26T12:11:13.513+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10433\",\"id\":\"10433\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-05-26T12:15:45.719+0200\",\"updated\":\"2013-05-26T12:15:45.719+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10434\",\"id\":\"10434\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-05-26T12:44:40.565+0200\",\"updated\":\"2013-05-26T12:44:40.565+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10435\",\"id\":\"10435\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-05-26T12:53:38.868+0200\",\"updated\":\"2013-05-26T12:53:38.868+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10440\",\"id\":\"10440\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362617\",\"name\":\"s362617\",\"emailAddress\":\"dd32438@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s362617&avatarId=10203\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s362617&avatarId=10203\"},\"displayName\":\"Dawid Drozd\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362617\",\"name\":\"s362617\",\"emailAddress\":\"dd32438@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s362617&avatarId=10203\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s362617&avatarId=10203\"},\"displayName\":\"Dawid Drozd\",\"active\":true},\"created\":\"2013-05-29T08:13:06.815+0200\",\"updated\":\"2013-05-29T08:13:06.815+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10442\",\"id\":\"10442\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362617\",\"name\":\"s362617\",\"emailAddress\":\"dd32438@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s362617&avatarId=10203\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s362617&avatarId=10203\"},\"displayName\":\"Dawid Drozd\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362617\",\"name\":\"s362617\",\"emailAddress\":\"dd32438@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s362617&avatarId=10203\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s362617&avatarId=10203\"},\"displayName\":\"Dawid Drozd\",\"active\":true},\"created\":\"2013-05-29T08:16:54.058+0200\",\"updated\":\"2013-05-29T08:16:54.058+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10444\",\"id\":\"10444\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362617\",\"name\":\"s362617\",\"emailAddress\":\"dd32438@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s362617&avatarId=10203\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s362617&avatarId=10203\"},\"displayName\":\"Dawid Drozd\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362617\",\"name\":\"s362617\",\"emailAddress\":\"dd32438@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s362617&avatarId=10203\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s362617&avatarId=10203\"},\"displayName\":\"Dawid Drozd\",\"active\":true},\"created\":\"2013-05-29T08:20:32.579+0200\",\"updated\":\"2013-05-29T08:20:32.579+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10446\",\"id\":\"10446\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362617\",\"name\":\"s362617\",\"emailAddress\":\"dd32438@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s362617&avatarId=10203\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s362617&avatarId=10203\"},\"displayName\":\"Dawid Drozd\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362617\",\"name\":\"s362617\",\"emailAddress\":\"dd32438@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&ownerId=s362617&avatarId=10203\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?ownerId=s362617&avatarId=10203\"},\"displayName\":\"Dawid Drozd\",\"active\":true},\"created\":\"2013-05-29T08:23:24.483+0200\",\"updated\":\"2013-05-29T08:23:24.483+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10454\",\"id\":\"10454\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-06-12T10:31:03.716+0200\",\"updated\":\"2013-06-12T10:31:03.716+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10455\",\"id\":\"10455\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-06-12T10:49:14.559+0200\",\"updated\":\"2013-06-12T10:49:14.559+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10456\",\"id\":\"10456\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-06-12T10:59:25.130+0200\",\"updated\":\"2013-06-12T10:59:25.130+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10457\",\"id\":\"10457\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-06-12T11:00:48.318+0200\",\"updated\":\"2013-06-12T11:00:48.318+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10458\",\"id\":\"10458\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-06-12T11:07:00.024+0200\",\"updated\":\"2013-06-12T11:07:00.024+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10459\",\"id\":\"10459\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-06-12T11:08:27.291+0200\",\"updated\":\"2013-06-12T11:08:27.291+0200\"},{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10460\",\"id\":\"10460\",\"author\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"body\":\"test1\",\"updateAuthor\":{\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"name\":\"s362631\",\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"avatarUrls\":{\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\",\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\"},\"displayName\":\"Dawid Jewko\",\"active\":true},\"created\":\"2013-06-12T11:17:23.111+0200\",\"updated\":\"2013-06-12T11:17:23.111+0200\"}]}"));
		server.play();

		DateFormat df = new SimpleDateFormat("EEE MMM dd HH:mm:ss yyyy");
		df.setTimeZone(TimeZone.getTimeZone("GMT"));

		ServerConnector.setServerURL(server.getUrl("/"));
		BasicAuthentication basic = new BasicAuthentication();
		Session session = basic.login(UserInfo.login, UserInfo.password);

		CommentFunction commentFunction = new CommentFunction(session, "BET-13");
		assertNotNull(commentFunction);
		CommentsList allComments = commentFunction.getAllComments();
		assertNotNull(allComments);
		assertEquals(0, allComments.getStartAt());
		assertEquals(21, allComments.getMaxResults());
		assertEquals(21, allComments.getTotal());
		ArrayList<Comment> comments = allComments.getComments();
		assertNotNull(comments);
		for (Comment comm : comments) {
			assertNotNull(comm);
		}
		assertEquals(21, comments.size());
		assertEquals("Marcin Skibicki", comments.get(0).getAuthor()
				.getDisplayName());
		assertEquals("umgnt ", comments.get(0).getBody());
		assertNotNull(comments.get(2).getAuthor());
		assertEquals("s362631", comments.get(2).getAuthor().getName());
		assertEquals("test1", comments.get(2).getBody());
		assertEquals(10460, comments.get(20).getId());
		assertEquals("Wed Jun 12 09:17:23 2013",
				df.format(comments.get(20).getCreated()));
		server.shutdown();
	}

	public void testSendComment() throws LoginException,
			BadResponse, IOException {

		MockWebServer server = new MockWebServer();
		server.enqueue(new MockResponse()
				.setBody("{\"session\":{\"value\":\"4192C9DD35545EFFDAA9EAE196AFAC41\",\"name\":\"JSESSIONID\"},\"loginInfo\":{\"previousLoginTime\":\"2013-06-07T10:13:55.759+0200\",\"loginCount\":184}}"));
		server.enqueue(new MockResponse().setResponseCode(201)
				.setBody("{\"id\":\"10462\",\"updateAuthor\":{\"active\":true,\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"displayName\":\"Dawid Jewko\",\"avatarUrls\":{\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\",\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\"},\"name\":\"s362631\"},\"body\":\"test1\",\"author\":{\"active\":true,\"emailAddress\":\"dj18125@st.amu.edu.pl\",\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/user?username=s362631\",\"displayName\":\"Dawid Jewko\",\"avatarUrls\":{\"48x48\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?avatarId=10118\",\"16x16\":\"https://jira.wmi.amu.edu.pl/secure/useravatar?size=small&avatarId=10118\"},\"name\":\"s362631\"},\"self\":\"https://jira.wmi.amu.edu.pl/rest/api/2/issue/10220/comment/10462\",\"updated\":\"2013-06-12T11:49:34.356+0200\",\"created\":\"2013-06-12T11:49:34.356+0200\"}"));
		server.play();
		
		DateFormat df = new SimpleDateFormat("EEE MMM dd HH:mm:ss yyyy");
		df.setTimeZone(TimeZone.getTimeZone("GMT"));
		
		ServerConnector.setServerURL(server.getUrl("/"));

		BasicAuthentication basic = new BasicAuthentication();
		Session session = basic.login(UserInfo.login, UserInfo.password);
		CommentFunction commentFunction = new CommentFunction(session, "BET-13");
		
		Comment comment1 = commentFunction.sendComment("test1");
		
		assertNotNull(comment1);
		assertEquals("test1", comment1.getBody());
		assertEquals(10462, comment1.getId());
		assertEquals(UserInfo.login, comment1.getAuthor().getName());
		assertEquals(UserInfo.login, comment1.getUpdateAuthor().getName());
		assertEquals("Wed Jun 12 09:49:34 2013", df.format(comment1.getCreated()));
		assertEquals("Wed Jun 12 09:49:34 2013", df.format(comment1.getUpdated()));
		
		server.shutdown();

	}

}
